<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        // https://leetcode-cn.com/problems/basic-calculator/
        // 实现一个基本的计算器来计算一个简单的字符串表达式的值。
        // 字符串表达式可以包含左括号(，右括号)， 加号 + ，减号 - ，非负整数和空格。
        // calculate("1 + 1");

        var calculate2 = function (s) {
            let arr = [],
                temp = '';
            for (let i = 0; i < s.length; i++) {
                temp = s[i];

                if (temp == ' ') //空格
                    continue;
                else if (temp >= '0' && temp <= '9') { //数字，碰到数字往前计算
                    while (s[i + 1] >= '0' && s[i + 1] <= '9' && i < s.length - 1) {
                        temp += s[i + 1];
                        i++;
                    }
                    arr.push(temp);
                    getResult(arr);
                } else { //其他左右括号，和+-号
                    arr.push(temp);

                    if (temp == ')') { //碰到右括号往前计算
                        getResult(arr);
                    }
                }
            }
            return arr.length == 1 ? arr[0] : 0;
        }

        //从栈顶往栈底计算
        function getResult(arr) { //arr为字符串数组
            while (true) {
                if (arr.length < 2) break;

                let last = arr.pop();

                if (last == ')') {
                    let last_p = parseInt(arr.pop()),
                        last_p_p = arr.pop();

                    if (last_p_p == "(") {
                        arr.push(last_p);
                    } else { //+ 或 -
                        let num = parseInt(arr.pop());
                        arr.push(last_p_p == "+" ? num + last_p : num - last_p);
                        arr.push(")")
                    }
                } else { //last为数字
                    let last_p = arr.pop();

                    if (last_p == "(") { //停止循环
                        arr.push("(");
                        arr.push(last);
                        break;
                    } else { //last_p 为 + 或 -
                        last = parseInt(last);
                        let num = parseInt(arr.pop())
                        arr.push(last_p == "+" ? num + last : num - last);
                    }
                }
            }
        }
        console.log(calculate2("(1+(4+5+2)-3)+(6+8)"));

    </script>

</body>

</html>
